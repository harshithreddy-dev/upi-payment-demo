<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Coding - UPI Payment Demo</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div id="app" class="bg-white shadow-2xl rounded-xl p-6 md:p-10 w-full max-w-md transform transition duration-500 ease-in-out hover:shadow-3xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Payment Gateway Demo</h1>
            <p class="text-sm text-gray-500 mt-1">Assignment: Custom UPI Deep-Link Flow</p>
        </header>

        <!-- Order Summary Card -->
        <div class="bg-blue-50 border border-blue-200 p-5 rounded-lg mb-6">
            <h2 class="text-xl font-semibold text-blue-800 mb-3">Order Summary</h2>
            
            <div class="space-y-2 text-gray-700">
                <div class="flex justify-between border-b border-blue-100 pb-1">
                    <span>Internship Test Fee:</span>
                    <span class="font-medium">₹1.00</span>
                </div>
                <div class="flex justify-between border-b border-blue-100 pb-1">
                    <span>Tax:</span>
                    <span class="font-medium">₹0.00</span>
                </div>
                <div class="flex justify-between pt-2 text-lg font-bold text-blue-900">
                    <span>Total Amount Due:</span>
                    <span>₹1.00</span>
                </div>
            </div>

            <div class="mt-4 text-xs text-gray-600 flex justify-between items-center bg-white p-3 rounded-md border border-dashed border-gray-300">
                <span id="orderId" class="font-mono text-xs">Order ID: Loading...</span>
                <button onclick="copyOrderId()" class="text-blue-500 hover:text-blue-700 transition duration-150 p-1 rounded-full hover:bg-gray-100" title="Copy Order ID">
                    <!-- Lucide Icon: Copy -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                </button>
            </div>
        </div>

        <!-- Payment Button -->
        <button id="payButton" onclick="redirectToPayment()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-[1.01] flex items-center justify-center space-x-2">
            <!-- Inline SVG for UPI Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-indian-rupee"><path d="M6 3h12"/><path d="M6 8h12"/><path d="M6 13l8.5 4.5 1.5-2.5"/><path d="M10 13h4"/></svg>
            <span>Pay ₹1.00 via UPI Deep-Link</span>
        </button>
        <p class="text-center text-xs text-gray-500 mt-2">This will attempt to open your default UPI App.</p>
        
        <!-- Verification Section (for demo) -->
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Manual UTR Verification (Demo)</h3>
            <p class="text-sm text-gray-600 mb-4">Since UPI deep-links do not automatically return status, enter the last 4 digits of the UTR below to simulate confirmation.</p>

            <div class="flex space-x-3">
                <input type="text" id="utrInput" maxlength="4" placeholder="Last 4 digits of UTR" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-center text-lg tracking-widest" oninput="this.value = this.value.replace(/[^0-9]/g, '').toUpperCase()">
                <button onclick="verifyPayment()" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-3 rounded-lg shadow-md transition duration-300 ease-in-out">
                    Verify
                </button>
            </div>

            <!-- Verification Status Message Box -->
            <div id="statusMessage" class="mt-4 p-3 rounded-lg hidden text-center font-medium"></div>

            <!-- Note: Mechanism to confirm payment -->
            <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm">
                <h4 class="font-bold text-yellow-800 mb-1">Verification Mechanism (Document Submission)</h4>
                <p class="text-yellow-700">
                    **1. Standard Method:** A dedicated **backend server** is required to receive Webhooks (e.g., from Cashfree) or poll the transaction status API. This is the secure way to confirm payment.
                    <br><br>
                    **2. Bonus/SMS Confirmation:** Web browsers are **securely prevented** from reading SMS messages (Android/iOS security). The only way to fulfill the bonus requirement is to build a dedicated **Android/iOS app** using SMS Reader permissions and the `upi://pay` deep link, then communicate the successful status to a backend server. **It is impossible to implement in this web-only file.**
                </p>
            </div>
        </div>
    </div>

    <script>
        // --- UPI Configuration (Required by Assignment) ---
        // CRITICAL: Replace this with a real, working Merchant VPA (like your Cashfree Business VPA or equivalent)
        const MERCHANT_VPA = "9989003549@ybl"; // Replace with your Merchant UPI ID
        const MERCHANT_NAME = "Harshith";
        const AMOUNT = "1.00"; // Fixed at INR 1.00 as requested
        
        // --- Utility Functions ---

        /**
         * Generates a simple, unique Order ID based on timestamp and a random suffix.
         * Format: VBC-YYYYMMDD-HHMMSS-XXXX
         */
        function generateOrderId() {
            const now = new Date();
            const datePart = now.getFullYear().toString() + 
                             (now.getMonth() + 1).toString().padStart(2, '0') + 
                             now.getDate().toString().padStart(2, '0');
            const timePart = now.getHours().toString().padStart(2, '0') + 
                             now.getMinutes().toString().padStart(2, '0') + 
                             now.getSeconds().toString().padStart(2, '0');
            const randomPart = Math.floor(1000 + Math.random() * 9000); // 4 digit random
            return `VBC-${datePart}-${timePart}-${randomPart}`;
        }

        /**
         * Copies the Order ID to the clipboard.
         */
        function copyOrderId() {
            const orderIdText = document.getElementById('orderId').textContent.replace('Order ID: ', '');
            // document.execCommand('copy') is used for compatibility in iFrame environments
            const tempInput = document.createElement('input');
            tempInput.value = orderIdText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            showMessage('Order ID copied to clipboard!', 'success');
        }

        /**
         * Displays a status message to the user.
         */
        function showMessage(message, type) {
            const msgBox = document.getElementById('statusMessage');
            msgBox.textContent = message;
            msgBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700');
            
            if (type === 'success') {
                msgBox.classList.add('bg-green-100', 'text-green-700');
            } else if (type === 'error') {
                msgBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                msgBox.classList.add('bg-yellow-100', 'text-yellow-700');
            }

            // Hide after 5 seconds
            setTimeout(() => {
                msgBox.classList.add('hidden');
            }, 5000);
        }

        // --- Core Payment Logic ---

        /**
         * Generates the unique ID on page load.
         */
        window.onload = function() {
            const newOrderId = generateOrderId();
            document.getElementById('orderId').textContent = `Order ID: ${newOrderId}`;
        };

        /**
         * Constructs the UPI Deep Link and redirects the user.
         */
        function redirectToPayment() {
            const orderId = document.getElementById('orderId').textContent.replace('Order ID: ', '');
            
            if (MERCHANT_VPA.includes("yourmerchantid")) {
                showMessage("CRITICAL: Please update the MERCHANT_VPA in the script with your active UPI ID.", 'error');
                return;
            }

            // Constructing the UPI Deep Link
            const upiLink = `upi://pay?pa=${MERCHANT_VPA}&pn=${encodeURIComponent(MERCHANT_NAME)}&am=${AMOUNT}&cu=INR&tn=${orderId}`;

            // Redirecting the window to the UPI deep link
            window.location.href = upiLink;

            // Show instruction for manual verification immediately
            showMessage('Redirecting to your UPI app. Please return here after payment to enter the UTR.', 'warning');
        }

        /**
         * Mock function to verify the UTR (for demo purposes only).
         */
        function verifyPayment() {
            const utr = document.getElementById('utrInput').value.trim();
            const orderId = document.getElementById('orderId').textContent.replace('Order ID: ', '');

            if (utr.length !== 4 || isNaN(utr)) {
                showMessage("Please enter exactly 4 digits for the UTR.", 'error');
                return;
            }

            // --- Mock Verification Logic ---
            // Simulating successful verification for UTRs ending in '9999' or '1234'
            if (utr === '9999' || utr === '1234') {
                showMessage(`SUCCESS! Payment for Order ${orderId} verified successfully using UTR ending in ${utr}. (Demo successful)`, 'success');
            } else {
                showMessage(`PENDING/FAILED. Payment for Order ${orderId} with UTR ending in ${utr} could not be confirmed. Please wait or check your bank statement. (Demo failure)`, 'error');
            }

            document.getElementById('utrInput').value = ''; // Clear input after attempt
        }
    </script>
</body>
</html>
