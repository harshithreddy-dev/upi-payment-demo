<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Coding - UPI Payment Demo</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'vibe-yellow': '#FACC15', // Tailwind yellow-400
                        'vibe-dark': '#1F2937', // Tailwind gray-800
                        'vibe-black': '#111827', // Tailwind gray-900
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        /* Ensuring all transitions are smooth */
        #app, button, input {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="bg-vibe-black min-h-screen flex items-center justify-center p-4">

    <div id="app" class="bg-vibe-dark shadow-2xl rounded-xl p-6 md:p-10 w-full max-w-md transform border border-gray-700 hover:shadow-[0_20px_50px_rgba(250,204,21,0.25)]">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-white">Payment Demo</h1>
            <p class="text-sm text-gray-400 mt-1">Vibe Coding - UPI Deep-Link Flow</p>
        </header>

        <!-- Order Summary Card -->
        <div class="bg-gray-700 border border-gray-600 p-5 rounded-lg mb-6 shadow-lg">
            <h2 class="text-xl font-bold text-vibe-yellow mb-3">Order Total</h2>
            
            <div class="space-y-2 text-gray-300">
                <!-- Removed test fee/tax breakdown, showing just the total -->
                <div class="flex justify-between pt-2 text-3xl font-extrabold text-white">
                    <span>Amount:</span>
                    <span>â‚¹1.00</span>
                </div>
            </div>

            <div class="mt-4 text-xs text-gray-400 flex justify-between items-center bg-gray-900 p-3 rounded-md border border-dashed border-gray-700">
                <span id="orderId" class="font-mono text-xs">Order ID: Loading...</span>
                <button onclick="copyOrderId()" class="text-vibe-yellow hover:text-white transition duration-150 p-1 rounded-full hover:bg-gray-700" title="Copy ID">
                    <!-- Lucide Icon: Copy (Color adjusted via text-color) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                </button>
            </div>
        </div>

        <!-- Payment Button -->
        <button id="payButton" onclick="redirectToPayment()" class="w-full bg-vibe-yellow hover:bg-yellow-500 text-gray-900 font-bold py-4 rounded-lg shadow-xl transition duration-300 ease-in-out transform hover:scale-[1.03] active:scale-[0.98] flex items-center justify-center space-x-3 text-lg">
            <!-- Inline SVG for UPI Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-indian-rupee"><path d="M6 3h12"/><path d="M6 8h12"/><path d="M6 13l8.5 4.5 1.5-2.5"/><path d="M10 13h4"/></svg>
            <span>PAY NOW</span>
        </button>
        <p class="text-center text-xs text-gray-500 mt-2">Opens UPI app via deep-link.</p>
        
        <!-- Verification Section (for demo) -->
        <div class="mt-8 pt-6 border-t border-gray-700">
            <h3 class="text-lg font-bold text-white mb-4">Verification</h3>
            <p class="text-sm text-gray-400 mb-4">Enter last 4 digits of UTR for demo confirmation.</p>

            <div class="flex space-x-3">
                <input type="text" id="utrInput" maxlength="4" placeholder="LAST 4 DIGITS" class="flex-grow p-3 border border-gray-600 bg-gray-900 text-white rounded-lg focus:ring-vibe-yellow focus:border-vibe-yellow text-center text-lg tracking-widest" oninput="this.value = this.value.replace(/[^0-9]/g, '').toUpperCase()">
                <button onclick="verifyPayment()" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-3 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    VERIFY
                </button>
            </div>

            <!-- Verification Status Message Box -->
            <div id="statusMessage" class="mt-4 p-3 rounded-lg hidden text-center font-semibold text-gray-900"></div>

            <!-- Note: Mechanism to confirm payment (Minimal Text) -->
            <div class="mt-6 p-4 bg-gray-900 border border-vibe-yellow rounded-lg text-sm shadow-inner">
                <h4 class="font-bold text-vibe-yellow mb-1">Verification Note</h4>
                <p class="text-gray-300">
                    Secure status confirmation requires a **backend server** (Webhooks/API polling). SMS confirmation is **impossible in a browser**.
                </p>
            </div>
        </div>
    </div>

    <script>
        // --- UPI Configuration (Required by Assignment) ---
        // CRITICAL: Replace this with a real, working Merchant VPA (like your Cashfree Business VPA or equivalent)
        const MERCHANT_VPA = "8247209662-1@okbizaxis"; // Replace with your Merchant UPI ID
        const MERCHANT_NAME = "Harshith";
        const AMOUNT = "1.00"; // Fixed at INR 1.00 as requested
        const MERCHANT_MCC = "5499"; // Standard Merchant Category Code (General Retail/Miscellaneous)
        const MERCHANT_MODE = "01"; // Person to Merchant Mode (P2M)
        
        // --- Utility Functions ---

        /**
         * Generates a simple, unique Order ID based on timestamp and a random suffix.
         */
        function generateOrderId() {
            const now = new Date();
            const datePart = now.getFullYear().toString() + 
                             (now.getMonth() + 1).toString().padStart(2, '0') + 
                             now.getDate().toString().padStart(2, '0');
            const timePart = now.getHours().toString().padStart(2, '0') + 
                             now.getMinutes().toString().padStart(2, '0') + 
                             now.getSeconds().toString().padStart(2, '0');
            const randomPart = Math.floor(1000 + Math.random() * 9000); // 4 digit random
            return `VBC-${datePart}-${timePart}-${randomPart}`;
        }

        /**
         * Copies the Order ID to the clipboard.
         */
        function copyOrderId() {
            const orderIdText = document.getElementById('orderId').textContent.replace('Order ID: ', '');
            // document.execCommand('copy') is used for compatibility in iFrame environments
            const tempInput = document.createElement('input');
            tempInput.value = orderIdText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            showMessage('ID Copied!', 'success');
        }

        /**
         * Displays a status message to the user.
         */
        function showMessage(message, type) {
            const msgBox = document.getElementById('statusMessage');
            msgBox.textContent = message;
            // Reset classes
            msgBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700', 'bg-green-400', 'bg-red-400', 'text-gray-900', 'font-semibold');
            
            // Set new dark mode classes
            msgBox.classList.add('font-bold', 'text-gray-900');
            
            if (type === 'success') {
                msgBox.classList.add('bg-green-400'); // Bright Green for success
            } else if (type === 'error') {
                msgBox.classList.add('bg-red-400'); // Bright Red for error
            } else {
                msgBox.classList.add('bg-vibe-yellow'); // Vibe Yellow for warning
            }
            msgBox.classList.remove('hidden');

            // Hide after 5 seconds
            setTimeout(() => {
                msgBox.classList.add('hidden');
            }, 5000);
        }

        // --- Core Payment Logic ---

        /**
         * Generates the unique ID on page load.
         */
        window.onload = function() {
            const newOrderId = generateOrderId();
            document.getElementById('orderId').textContent = `Order ID: ${newOrderId}`;
        };

        /**
         * Constructs the UPI Deep Link and redirects the user.
         */
        function redirectToPayment() {
            const orderId = document.getElementById('orderId').textContent.replace('Order ID: ', '');
            
            if (MERCHANT_VPA.includes("vibe.coding.test@cashfree")) {
                showMessage("UPDATE VPA! Using placeholder ID.", 'warning');
            }

            const currentUrl = window.location.href.split('?')[0]; // Get URL without query params

            // UPI DEEP LINK: Including 'mc', 'mode', and 'url' for best web compatibility
            const upiLink = `upi://pay?pa=${MERCHANT_VPA}&pn=${encodeURIComponent(MERCHANT_NAME)}&am=${AMOUNT}&cu=INR&tn=${orderId}&mc=${MERCHANT_MCC}&mode=${MERCHANT_MODE}&url=${encodeURIComponent(currentUrl)}`;

            // Redirecting the window to the UPI deep link
            window.location.href = upiLink;

            // Show instruction for manual verification immediately
            showMessage('Launching UPI App...', 'warning');
        }

        /**
         * Mock function to verify the UTR (for demo purposes only).
         */
        function verifyPayment() {
            const utr = document.getElementById('utrInput').value.trim();
            const orderId = document.getElementById('orderId').textContent.replace('Order ID: ', '');

            if (utr.length !== 4 || isNaN(utr)) {
                showMessage("Enter 4 digits.", 'error');
                return;
            }

            // --- Mock Verification Logic ---
            // Simulating successful verification for UTRs ending in '9999' or '1234'
            if (utr === '9999' || utr === '1234') {
                showMessage(`SUCCESS! Order ${orderId} verified.`, 'success');
            } else {
                showMessage(`FAILED. Cannot confirm Order ${orderId}.`, 'error');
            }

            document.getElementById('utrInput').value = ''; // Clear input after attempt
        }
    </script>
</body>
</html>
